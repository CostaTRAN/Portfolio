<!DOCTYPE html>
<html lang="fr" vocab="http://schema.org/" typeof="WebPage" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio de Costa TRAN</title>
    <!-- Styles CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- Balise alternate pour SEO -->
    <link rel="alternate" hreflang="en" href="index.html?lang=en">
    <link rel="alternate" hreflang="fr" href="index.html?lang=fr">
    <link rel="alternate" hreflang="ja" href="index.html?lang=ja">
</head>

<body>
    <header>
        <h1 id="title">Portfolio de Costa TRAN</h1>
    </header>
    <nav>
        <a id="homepage" href="index.html">Accueil</a>
        <a id="cv" href="cv.html">CV</a>
        <!-- Sélecteur de langue -->
        <div id="lang-selector">
            <img src="./img/fr-flag.png" alt="Français" class="flag" data-lang="fr">
            <img src="./img/en-flag.png" alt="English" class="flag" data-lang="en">
            <img src="./img/ja-flag.png" alt="日本語" class="flag" data-lang="ja">
        </div>
    </nav>
    <main>
        <!-- Contenu principal -->
        <section>
            <h2 id="about">À propos de moi</h2>
            <p id="about_content">Étudiant à l'école d'ingénieur Sup Galilée dans la spécialité informatique en
                apprentissage et apprenti ingénieur logiciel chez Forvia.</p>
        </section>
        <section>
            <h2 id="video">Vidéo de présentation</h2>
            <iframe id="video_content" width="700" height="400"
                src="https://www.youtube.com/embed/tqSVEwSkhAU?cc_lang_pref=fr&cc_load_policy=1"
                title="Présentation de Costa TRAN"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </section>
    </main>
    <footer>
        <p id="copyright">&#169; 2024 Costa TRAN. Tous droits réservés.</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            function getLanguage() {
                let lang = getQueryParam('lang');
                if (lang) return lang;

                lang = sessionStorage.getItem('lang');
                if (lang) return lang;

                lang = navigator.language.split('-')[0];
                if (['en', 'fr', 'ja'].includes(lang)) return lang;

                return 'fr';
            }

            function fetchContent(lang) {
                fetch(`./${lang}/content.xml`)
                    .then(response => response.text())
                    .then(str => (new window.DOMParser()).parseFromString(str, "application/xml"))
                    .then(data => {
                        document.getElementById('title').textContent = data.querySelector('title').textContent;
                        document.getElementById('homepage').textContent = data.querySelector('homepage').textContent;
                        document.getElementById('cv').textContent = data.querySelector('cv').textContent;
                        document.getElementById('about').textContent = data.querySelector('about').textContent;
                        document.getElementById('about_content').textContent = data.querySelector('about_content').textContent;
                        document.getElementById('video').textContent = data.querySelector('video').textContent;
                        document.getElementById('copyright').textContent = data.querySelector('copyright').textContent;
                    })
                    .catch(error => console.error('Error loading content:', error));
            }

            function changeVideoSubtitlesLanguage(lang) {
                var iframe = document.getElementById('video_content');
                var youtubeLangCode = lang || 'fr';
                iframe.src = iframe.src.replace(/cc_lang_pref=[a-zA-Z-]{2}/, 'cc_lang_pref=' + youtubeLangCode);
            }

            document.getElementById('lang-selector').addEventListener('click', function (event) {
                if (event.target.classList.contains('flag')) {
                    const selectedLang = event.target.dataset.lang;
                    fetchContent(selectedLang);
                    changeVideoSubtitlesLanguage(selectedLang);
                    window.history.pushState({}, '', `?lang=${selectedLang}`);
                    sessionStorage.setItem('lang', selectedLang);
                }
            });

            const lang = getLanguage();
            sessionStorage.setItem('lang', lang);
            fetchContent(lang);
            changeVideoSubtitlesLanguage(lang);
        });
    </script>
</body>

</html>